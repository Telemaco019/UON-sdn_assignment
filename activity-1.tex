\section*{Lab activity 1}





\subsection*{Learning objectives}
After finishing this lab activity you will be able to:
\begin{itemize}
  \item Implement a cluster of local controllers inside Mininet using the Python
  middle-level Mininet API
  \item Test the network connectivity and the performance of a network which
  includes a cluster of local controllers
  \item Understand the main functions provided by the middle-level Mininet API required
  to implement a cluster of local controllers
  \item Reflect about the reasons of using more then one controller in SDN networks
\end{itemize}






\subsection*{Scenario}
In this activity you will implement the simple topology shown in figure \ref{fig:topology-1} using
a Python script and the middle-level API provided by Mininet. The two controllers
shown in the topology diagram will be local controllers for this activity.
The topology has two different switches: each one will be connected to a different
local controller.

Begin by creating a new Python script, then import Mininet classes required for
this activity and define the function that will be used to create the topology.
Inside the body of this function, create a new Mininet netowrk and add to it the
required hosts, switches, links and controllers. After writing the script, execute
it to create the network and test its connectivity and performance.

This lab activity assumes you are proficient in [...]. A basic knowledge of the
Python programming language is also assumed.





\subsection*{Task 1: write the skeleton of the Python script}
\subsubsection*{Step 1}
Create a new Python script and edit with the text editor you prefer. If your editing
it inside the Mininet virtual machine, it is suggested to use Vim text editor.

\subsubsection*{Step 2}
Import the Python classes from the Mininet API:
\begin{lstlisting}
#!/usr/bin/Python
from mininet.net import Mininet
from mininet.node import Controller, OVSSwitch
from mininet.cli import CLI
from mininet.log import setLogLevel, info
\end{lstlisting}

\subsubsection*{Step 3}
Make the script executable onyl as a program, set the verbosity level to ``info''
and call the function \code{multiControllerNet()}, which will be defined in the next
step and will be used to create the required topology:
\begin{lstlisting}
if __name__ == '__main__':
    setLogLevel( 'info' )
    multiControllerNet()
\end{lstlisting}

\subsubsection*{Step 4}
Define the function that will be used to create the topology:
\begin{lstlisting}
def multiControllerNet():
\end{lstlisting}

\subsubsection*{Step 6}
Inside the body of the function \code{multiControllerNet()} create a new Mininet
network:
\begin{lstlisting}
net = Mininet( controller=Controller, switch=OVSSwitch )
\end{lstlisting}

The Mininet network is created invoking the Mininet constructor: the parameters
passed to the constructor are the Controller class and the OVSSwitch class, therefore
the Stanford/OpenFlow reference controllers and Open vSwitch switches will be used
in the network we are goind to create. Note that these two classes are
the default parameters in the Mininet constructor, so it is not really necessary
to specify them.

\subsubsection*{Step 7}
Save the text file as ``\emph{controllers-1.py}'' in your custom directory inside
the mininet virtual machine.





\subsection*{Task 2: add hosts to the network}
\subsubsection*{Step 1}
Inside the body of the function \code{multiControllerNet()} add the following line
of code in order to print to the console that hosts are being created:
\begin{lstlisting}
info( "*** Creating hosts \n" )
\end{lstlisting}

\subsubsection*{Step 2}
Still inside the body of the function \code{multiControllerNet()}, create the
four hosts required for the topology by adding them to the mininet network
previously created:
\begin{lstlisting}
h1 = net.addHost('h3')
h2 = net.addHost('h4')
h3 = net.addHost('h5')
h4 = net.addHost('h6')
\end{lstlisting}
The function used to add the hosts to the network is \code{addHost('name')}, which
accept as parameter the name of the host that will be created. The hosts names in
this network therefore will be \code{h3}, \code{h4}, \code{h5} and \code{h6}.





\subsection*{Task 3: add switches to the network}
\subsubsection*{Step 1}
Inside the body of the function \code{multiControllerNet()} add the following line
of code in order to print to the console that switches are being created:
\begin{lstlisting}
info( "*** Creating switches \n" )
\end{lstlisting}

\subsubsection*{Step 2}
Still inside the body of the function \code{multiControllerNet()}, create the
two switches required for the topology by adding them to the mininet network
previously created:
\begin{lstlisting}
s1 = net.addSwitch('s1')
s2 = net.addSwitch('s2')
\end{lstlisting}







\subsection*{Task 4: create links between nodes}
\subsubsection*{Step 1}
Inside the body of the function \code{multiControllerNet()} add the following line
of code in order to print to the console that links are being created:
\begin{lstlisting}
info( "*** Creating links \n" )
\end{lstlisting}

\subsubsection*{Step 2}
Still inside the body of the function \code{multiControllerNet()}, create the
links between the hosts and the switches and the link between the two switches:
\begin{lstlisting}
net.addLink( h3, s1 )
net.addLink( h4, s1 )
net.addLink( h5, s2 )
net.addLink( h6, s2 )
net.addLink( s1, s2 )
\end{lstlisting}






\subsection*{Task 5: create the controllers}
\subsubsection*{Step 1}
Inside the body of the function \code{multiControllerNet()} add the following line
of code in order to print to the console that reference controllers are being created:
\begin{lstlisting}
info( "*** Creating (reference) controllers \n" )
\end{lstlisting}

\subsubsection*{Step 2}
Still inside the body of the function \code{multiControllerNet()}, add to the
Mininet network the two required controller:
\begin{lstlisting}
c0 = net.addController( 'c0', port=6633 )
c1 = net.addController( 'c1', port=6634 )
\end{lstlisting}

The function use to create the controllers is \code{addController}, which accept
as parameters the name of the controller which will be created and the TCP port that
will be used by the switches for connecting to the controller.







\subsection*{Task 6: start the mininet network}
\subsubsection*{Step 1}
Append to the body the function \code{multiControllerNet()} the following line
of code for printing to the console that the network is being started:
\begin{lstlisting}
info( "*** Starting network \n" )
\end{lstlisting}

\subsubsection*{Step 2}
Build the Mininet network:
\begin{lstlisting}
net.build()
\end{lstlisting}

\subsubsection*{Step 3}
Start the controllers:
\begin{lstlisting}
c0.start()
c1.start()
\end{lstlisting}

\subsubsection*{Step 4}
Start the switches, specifying for each switch the controller to wich connect:
\begin{lstlisting}
s1.start( [ c0 ] )
s2.start( [ c1 ] )
\end{lstlisting}

\subsubsection*{Step 5}
Start the Mininet CLI:
\begin{lstlisting}
info( "*** Running CLI\n" )
CLI( net )
\end{lstlisting}

\subsubsection*{Step 6}
Stop the network so that after the user exits the Mininet CLI the network is
stopped:
\begin{lstlisting}
info( "*** Stopping network\n" )
net.stop()
\end{lstlisting}

% Because each swtich has to setup one TCP connection to each controller and
% it's not possible having more than one TCP connection on the same port, so
% specifying two different ports makes it possible to connect one single switch
% to multiple controllers.



\subsection*{Task 7: execute the script and test the network}
After finishing the task 6 the script for implementing the required topology is
completed. The full script is shown in listing \ref{lst:activity-1-script} at the
bottom of this activity.

\subsubsection*{Step 1}
Execute the script as root: \\
\code{\$ sudo python controllers1.py}

\subsubsection*{Step 2}
Test the created topology: verify the network connectivity between all hosts
and the bandwidth between \code{h3} and \code{h6}. Write in the lines below the
commands you used and the results you obtained.

\hrulefill

\hrulefill

\hrulefill

\hrulefill





\subsection*{Task 8: reflection}
\subsubsection*{1 - What are the advantages of having more controllers instead of one
single controller which serves all the switches of the network?}
\hrulefill

\hrulefill

\hrulefill

\hrulefill

\subsubsection*{2 - Would the fault tolerance of the netowrk shown in figure
\ref{fig:topology-1} change if we used only one controller instead of two?}
\hrulefill

\hrulefill

\hrulefill

\hrulefill

\subsubsection*{3 - How could we improve the fault tolerance of the netowrk shown
in figure \ref{fig:topology-1}?} % Each switch connected to both controllers, each controller
% could be a distributed controller
\hrulefill

\hrulefill

\hrulefill

\hrulefill

\lstset{
 showspaces=false,
 showtabs=false,
 frame=single,
 tabsize=2,
 breaklines=true,
 numbers=left,
 showstringspaces=false,
 breakatwhitespace=true,
 escapeinside={(*@}{@*)},
 keywordstyle=\bfseries,
 basicstyle=\scriptsize\ttfamily,
}

\begin{minipage}{\linewidth}
\begin{lstlisting}[label=lst:activity-1-script, caption=complete Python script required for Activity 1]
#!/usr/bin/Python
from mininet.net import Mininet
from mininet.node import Controller, OVSSwitch
from mininet.cli import CLI
from mininet.log import setLogLevel, info

if __name__ == '__main__':
    setLogLevel( 'info' )
    multiControllerNet()

def multiControllerNet():
    net = Mininet( controller=Controller, switch=OVSSwitch )

    info( "*** Creating hosts\n" )
    h1 = net.addHost('h3')
    h2 = net.addHost('h4')
    h3 = net.addHost('h5')
    h4 = net.addHost('h6')

    info( "*** Creating switches\n" )
    s1 = net.addSwitch( 's1' )
    s2 = net.addSwitch( 's2' )

    info( "*** Creating links\n" )
    net.addLink( h3, s1 )
    net.addLink( h4, s1 )
    net.addLink( h5, s2 )
    net.addLink( h6, s2 )
    net.addLink( s1, s2 )

    info( "*** Creating (reference) controllers\n" )
    c0 = net.addController( 'c0', port=6633 )
    c1 = net.addController( 'c1', port=6634 )

    info( "*** Starting network\n" )
    net.build()
    c0.start()
    c1.start()
    s1.start( [ c0 ] )
    s2.start( [ c1 ] )

    info( "*** Running CLI\n" )
    CLI( net )

    info( "*** Stopping network\n" )
    net.stop()
\end{lstlisting}
\end{minipage}
